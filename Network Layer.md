## Network Layer

- 主要任务：把**分组**从源端传到目的端，为分组交换网上的不同主机提供通信服务
- 网络层传输单位是**数据报**
- **数据报是长的数据，分组是切割后的**
- 功能
  - 路由选择与分组转发
  - 异构网络互联：依靠路由器
  - 拥塞控制：全局性的概念
    - 若所有结点都来不及**接受分组**，而要丢弃大量分组的情况
    - 开环控制和闭环控制
      - 静态的开环控制：在运行前考虑各种可能引发拥塞的因素
      - 动态的闭环控制：运行后再控制拥塞

[TOC]

### 数据交换方式

- 电路交换

  - 电话网络

- 报文交换

  - 存储转发

- 分组交换

  - 转发的是分组（把报文切割成分组）
  - 缓存要求较小，但需要传输额外的信息量
  - 乱序到目的主机，要对分组排序重组

- **数据报方式&虚电路方式**

  ![image-20201216190928405](Network%20Layer.assets/image-20201216190928405.png)

  - 数据报方式为网络层提供**无连接服务**

    - 不事先为分组的传输确定路径，不同分组传输路径可能不同
    - 每个分组携带源和目的地址
    - 路由器根据分组的目的地址转发分组，每个分组独立选路

  - 虚电路方式为网络层提供**连接服务**

    ![image-20201216191227364](Network%20Layer.assets/image-20201216191227364.png)

    - 首先为分组的传输确定传输路径（建立连接），**系列分组的传输路径相同**
    - 传输结束后拆除连接
    - 传输单位是分组，每个分组携带了**虚电路号**
    - 保证分组有序到达

### 路由算法

- <img src="Network%20Layer.assets/image-20201216192233122.png" alt="image-20201216192233122" style="zoom:50%;" />

- 静态 / 动态路由算法

  - 静态：适合拓扑变化不大的网络，路由更新慢
  - 动态：路由器之间交换信息，优化出路由表项，增加网络负担

- 动态路由算法：全局性 / 分散性

  - 链路状态路由算法 OSPF
    - **所有路由器掌握完整的网络拓扑和链路费用信息**
  - 距离向量路由算法 RIP
    - **路由器只掌握物理相连的邻居及链路费用**

- 分层次的路由选择协议

  <img src="Network%20Layer.assets/image-20201216192856045.png" alt="image-20201216192856045" style="zoom: 80%;" />

### TCP/IP协议栈

<img src="Network%20Layer.assets/image-20201216193045061.png" alt="image-20201216193045061" style="zoom:67%;" />

#### IP数据报格式

- IP数据报过大就会分片，分片后成为分组

<img src="Network%20Layer.assets/image-20201216193254632.png" alt="image-20201216193254632" style="zoom: 80%;" />

- 固定部分：**20字节**

<img src="Network%20Layer.assets/image-20201216193619430.png" alt="image-20201216193619430" style="zoom: 50%;" />

<img src="Network%20Layer.assets/image-20201216193358389.png" alt="image-20201216193358389" style="zoom: 67%;" />

- 版本：IPv4 / IPv6

- 首部长度：4位，**单位是4字节**，首部长度最小是5（固定部分是20字节）

- 区分服务：期望获得哪种类型的服务

- 总长度：首部+数据，**单位是1字节**

- 生存时间TTL：IP分组的保质期，经过一个路由器就减1，变成0则丢弃

- 协议：8位，数据部分所使用的协议

  <img src="Network%20Layer.assets/image-20201216194054887.png" alt="image-20201216194054887" style="zoom: 67%;" />

- 首部检验和：**只检验首部**，二进制的求和

- 源IP地址和目的IP地址：**32位**

- **可选字段：支持排错测量以及安全等措施**

- 填充：全0，把首部补成4字节的整数倍

- **先源地址，后目的地址**

#### IP数据报分片

- 最大传送单元MTU：链路层数据帧可封装数据的上限

- 标识：同一数据报的分片使用同一标识

- 标志：有3位，低两位才有意义

  - 中间位DF（Don't Fragment）：1禁止分片，0允许分片
  - 最低位MF（**More Fragment**）：1表示后面还有分片，0表示最后一片/没分片
    - DF = 0时才有意义

- 片偏移：有13位，指出分片后，某片在原分组中的相对位置，**以8B为单位**

  - 除了最后一个分片，**每个分片的长度一定是8B的整数倍**

- 考虑切割时，需要考虑切割后还需要加上20字节的报头长度，再和MTU比较

  ![image-20201216200652440](Network%20Layer.assets/image-20201216200652440.png)

- 总长度单位是1B，首部长度单位是4B，片偏移单位是8B

  - **一（1）种（总长度）8片（偏移）首（首部）饰（4）**

#### IPv4地址

- 分类的IP地址，子网的划分，构成超网（无分类编址方法）
- IP地址：全世界唯一的32位标识符，标识路由器或主机的接口
  - 一个主机可以有若干接口
  - 网络号，主机号
- 网桥：不能够分割广播域，仍然是一个局域网，网络号相同
- 无名（无编号）网络

##### 分类的IP地址

<img src="Network%20Layer.assets/image-20201217000432569.png" alt="image-20201217000432569" style="zoom:67%;" />

- 网络号、主机号全0
  - 发送分组的时候不知道自己的IP地址，作为源地址
- 网络号全0，主机号不为0
  - 可以作为目的地址，表示本网内的特定主机
- 网络号和主机号全1
  - 可以作为目的地址，受限地址，向**本网**所有主机发送广播分组
  - 路由器可以隔离广播域
- 主机号全0：表示一个网络，不可以作为源或目的地址
- 主机号全1
  - 可以作为目的地址，向特定网络上的所有主机进行**广播**

![image-20201217000614784](Network%20Layer.assets/image-20201217000614784.png)

- 私有IP地址

  - 网段个数：可以分配的网络号

  <img src="Network%20Layer.assets/image-20201217001158172.png" alt="image-20201217001158172" style="zoom:67%;" />

![image-20201217001310131](Network%20Layer.assets/image-20201217001310131.png)

- A类
  - 最大可用网络数：注意127是特殊的
  - **主机号全1：广播地址**

#### 网络地址转换 NAT

- 路由器对目的地址是私有IP地址的数据报一律不进行转发

![image-20201217002706142](Network%20Layer.assets/image-20201217002706142.png)

- A发送给B的包包含：源IP，目的IP，端口号
  - 在NAT路由器将源IP与端口号做转换
- B发送给A的包包含：源IP，目的IP（全球IP地址），端口号
  - 在NAT路由器将目的IP与端口号做转换

#### 子网划分和子网掩码

- 子网划分

  ![image-20201217124817862](Network%20Layer.assets/image-20201217124817862.png)

  - 某单位划分子网后，对外仍**表现为一个网络**，即本单位外的网络看不见本单位内子网的划分
  - 至少需要留两位作为主机号（如果只有一位，就只有全0或全1）
  - 子网号能否全0全1要看情况
  - 主机号不能全0全1

- 子网掩码

  <img src="Network%20Layer.assets/image-20201217125133431.png" alt="image-20201217125133431" style="zoom:67%;" />

  - 子网掩码与IP地址与，就得到**子网网络地址**
  - <img src="Network%20Layer.assets/image-20201217125551881.png" alt="image-20201217125551881" style="zoom: 67%;" />

- D

  ![image-20201217142020678](Network%20Layer.assets/image-20201217142020678.png)

- 使用子网时分组的转发

  - 对于每个路由器的路由表存储：
    - 目的网络地址、**目的网络子网掩码**、下一跳地址
  - 路由器需要判断是否直接交付
  - 如果没有子网符合，判断是否是特定主机路由
  - 如果没有，再检测路由表中有无路径
  - 默认路由0.0.0.0
  - 丢弃，报告转发分组出错

#### 无分类编址CIDR

- 变长子网掩码：不同子网的主机个数不同

  <img src="Network%20Layer.assets/image-20201217210323663.png" alt="image-20201217210323663" style="zoom:50%;" />

- CIDR记法：IP地址后加上/，然后写上网络前缀的位数

  <img src="Network%20Layer.assets/image-20201217211302186.png" alt="image-20201217211302186" style="zoom:67%;" />

##### 构成超网

- 将多个子网聚合成一个较大的子网，叫做构成超网

- 将网络前缀缩短

- 最长前缀匹配

  - 使用CIDR时，查找路由表可能得到几个匹配结果，硬选择具有最长网络前缀的路由
  - 前缀最长，地址块越小，路由越具体

  ![image-20201217214601643](Network%20Layer.assets/image-20201217214601643.png)

  - B

- ![image-20201217215142719](Network%20Layer.assets/image-20201217215142719.png)

  - B

#### ARP协议

- **划分到网络层，为IP协议提供服务**

- 发送数据的过程

  ![image-20201218194018243](Network%20Layer.assets/image-20201218194018243.png)

  - 集线器：物理层设备，交换机：链路层设备
  - 传输层根据DNS得到IP3
  - 数据链路层需要加上目的MAC地址，但是一开始是不知道目的MAC地址的
  - ARP高速缓存：某个IP地址对应的MAC地址是什么
    - 只包含**局域网内部**的主机：1号主机存的表项可能是2，3，以及路由器端口的*ip地址-MAC*映射

- ARP协议

  ![image-20201218194923963](Network%20Layer.assets/image-20201218194923963.png)

  - 首先广播ARP请求分组
  - 交换机 会广播这个请求分组
  - **单播**ARP响应分组
  - 上面是在同一个局域网的情况

- 1号主机和5号主机进行通信

  ![image-20201218200138602](Network%20Layer.assets/image-20201218200138602.png)

  - **主机和路由器端口才有MAC地址**
  - 高速缓存只会存局域网内部的映射，因此5号肯定没有
  - 1号主机会把自己的子网掩码和IP5相与，看看是不是自己的网段内
  - 不在，于是查询默认网关的MAC地址
    - **默认网关：与外界沟通的路由器，局域网连入外界（因特网）的关口**
  - 目的地址就填入默认网关的MAC地址
  - 但是这个MAC地址还不知道，需要重复上面的ARP广播（填入默认网关的IP6）
  - 填好MAC6后，传到了路由器，进行数据的解封装（**最高到网络层，路由器是三层设备**）
  - 再封装：IP1, IP5, MAC7, MAC8
    - **路由器也可能不知道下一跳的MAC地址**
    - （**再看看**）点对点：PPP协议，目的地址全1
    - 如果不是点对点，填MAC8
  - 再进行一遍解封装和封装：IP1, IP5, MAC9, MAC5
    - MAC5如何得到？又要进行一次广播

- 本质原因：在实际网络的链路上传送数据帧时，最终必须使用MAC地址

  - ARP协议：完成主机或路由器IP地址到MAC地址的映射
  - 主机换网卡：MAC地址也换了

![image-20201218200902785](Network%20Layer.assets/image-20201218200902785.png)

![image-20201218201214710](Network%20Layer.assets/image-20201218201214710.png)

#### DHCP协议

- 主机如何获得IP地址

  - 静态配置：IP地址，子网掩码，默认网关

  - 动态配置

    - 每一个教学楼有一个网段，每一个网段有如下设备：

    <img src="Network%20Layer.assets/image-20201218205653588.png" alt="image-20201218205653588" style="zoom: 67%;" />

    - 移动设备到了教室内，就需要由DHCP服务器动态地给它分配IP地址

- 动态主机配置协议DHCP是**应用层**协议，使用**客户/服务器**方式，客户端和服务端通过**广播**方式进行交互，基于**UDP**

- DHCP提供**即插即用**联网的机制，主机可以从服务器动态获取IP地址、子网掩码、默认网关、DNS服务器名称与IP地址

  - 允许地址重用：新的主机可以用旧的给过别人的地址
  - 支持移动用户加入网络
  - 支持在用地址续租

- DHCP工作流程（全都是广播）

  - 主机通过**广播**的方式发送**DHCP发现**报文
    - 试图找到网络中的DHCP服务器，服务器获得一个IP地址
  - DHCP服务器广播**DHCP提供**报文
    - 服务器拟分配给主机一个IP地址及相关配置，先到先得
  - 主机广播**DHCP请求**报文
    - 主机向服务器请求所提供的IP地址，广播的方式可以告知没被它选中的DHCP服务器它已经选好了第一个返回的DHCP服务器
  - DHCP服务器广播**DHCP确认**报文
    - 正式将IP地址分配给主机

#### ICMP协议

- 为了更有效地转发IP数据报，提高交付成功的机会
- 网际控制报文协议，网络层的协议
- 支持主机或路由器
  - 差错或异常报告（差错报告报文）
  - 网络探询问
- ICMP报文装在IP数据报的数据部分

<img src="Network%20Layer.assets/image-20201220215625058.png" alt="image-20201220215625058" style="zoom:67%;" />

- 代码：进一步区分某种类型中的不同情况

- 检验和：检验整个ICMP报文

- ICMP差错报文

  ![image-20201220220043135](Network%20Layer.assets/image-20201220220043135.png)

  - 源点抑制：现在基本取消

  <img src="Network%20Layer.assets/image-20201220220201362.png" alt="image-20201220220201362" style="zoom:50%;" />

  <img src="Network%20Layer.assets/image-20201220220400036.png" alt="image-20201220220400036" style="zoom: 67%;" />

- ICMP询问报文

  ![image-20201220220524224](Network%20Layer.assets/image-20201220220524224.png)

  - ping：回送请求和回答报文
  - 后两种现在已不再使用

- ICMP

  - PING：测试两个主机之间的连通性
  - Traceroute：跟踪一个分组从源点到终点的路径，使用了ICMP时间超过差错报告报文

#### IPv6

- 从根本上解决地址耗尽问题
- 改进首部格式：快速处理/转发数据报
- 支持QoS（服务质量）
  - Quality of Service
  - 指一个网络能够利用各种基础技术，为指定的网络通信提供更好的服务能力
  - 是网络的一种安全机制，用来解决网络延迟和阻塞等问题的一种技术

##### IPv6数据报格式

<img src="Network%20Layer.assets/image-20201219120834578.png" alt="image-20201219120834578" style="zoom: 80%;" />

- 把IPv4的可变部分，移到了有效载荷中
- 固定**40B**的基本首部
- 如果要加入扩展功能，就放入扩展首部
  - 使得IPv4首部一些不用的部分可以先不放在首部，要用再放到扩展首部

<img src="Network%20Layer.assets/image-20201219121050562.png" alt="image-20201219121050562" style="zoom:50%;" />

- 版本：总是6
- 优先级：区分数据报的类别和**优先级**
- 流标签：所有属于同一个**流**的数据报都具有同样的流标签
- 有效载荷长度：指的是扩展首部 + 数据
  - IPv4：
    - 首部长度字段
    - 总长度：首部 + 数据
- 下一个首部：标识**下一个扩展首部**或**上层协议首部**
  - 如果有效载荷里面有扩展首部，就指向下一个扩展首部
- 跳数限制：相当于IPv4的TTL

##### IPv6和IPv4

- 32位 -> **128位**
- 将校验和字段彻底移除，以减少每跳的处理时间
- 将可选字段移出首部，变成了**扩展首部**，成为灵活的首部格式
  - 路由器通常不对扩展首部进行检查，大大提高了路由器的处理效率
- IPv6支持**即插即用**（即自动配置），不需要DHCP协议
- **IPv6首部长度必须是8B的整数倍，IPv4首部是4B的整数倍**
  - 一种八片的首饰
- **IPv6只能在主机处分片，IPv4可以在路由器和主机处分片**
- ICMPv6：增加报文类型“分组过大”
- IPv6支持资源的预分配，支持实时视像等要求，保证一定的带宽和时延的应用
- IPv6取消了协议字段，改成下一个首部字段
  - IPv4的协议字段：分组的数据部分应该交给哪一个传输层协议
- IPv6取消了总长度字段，改用有效载荷长度字段
  - IPv4有首部长度和总长度，首部其实是固定的
- IPv6取消了服务类型字段

##### IPv6地址表示形式

<img src="Network%20Layer.assets/image-20201219122845650.png" alt="image-20201219122845650" style="zoom:67%;" />

##### IPv6基本地址类型

- 单播：一对一通信，可做源地址 + 目的地址
- 多播：一对多通信，只能作为目的地址
  - 和多播组内的所有主机进行通信
  - 没有使用广播地址：多播可以做广播
  - IPv4广播：发给局域网内的所有结点
- 任播：一对多中的一个通信：可做目的地址
  - 一台主机IP数据报中封装的目的地址是任播地址
  - 就会给任播组内的一台主机发送数据报（一般是离它最近的那台）

##### IPv4向IPv4过渡的策略

- 双栈协议
- 隧道技术
  - 把IPv6数据报作为数据部分进行传输

![image-20201219192627757](Network%20Layer.assets/image-20201219192627757.png)



### 路由算法

![image-20201226202319724](Network%20Layer.assets/image-20201226202319724.png)

- 自治系统AS：autonomous system

#### RIP协议及距离向量算法

- 适用于比较小的网络
- RIP是一种分布式的基于**距离向量**的路由选择协议，是**因特网**的协议标准，**简单**
- 要求网络中的每一个路由器都维护**从它自己到其他每一个目的网络的唯一最佳距离记录**
- RIP允许一条路由最多只能包含15个路由器，**因此距离为16表示网络不可达**
  - 距离：从源端口到目的端口所经过的路由器的个数
  - 特别的，从一个路由器到直接连接的网络距离为1（本身也算）
  - 适用于小互联网

##### 协议规定

- RIP协议和谁交换？
  - 仅和相邻路由器交换信息
- 路由器交换的信息是自己的路由表
- 每30秒交换一次路由信息，然后路由器根据新信息更新路由器
  - 若超过180s没收到邻居路由器的通告，则判断邻居没了，并更新自己路由表
    - 把X记为不可达的路由器，即把距离设置成16

##### 距离向量算法

- 交换的是RIP报文
- ![image-20201226204102099](Network%20Layer.assets/image-20201226204102099.png)
- <img src="Network%20Layer.assets/image-20201226204225103.png" alt="image-20201226204225103" style="zoom:67%;" />

##### RIP协议的报文格式

<img src="Network%20Layer.assets/image-20201226205142052.png" alt="image-20201226205142052" style="zoom:50%;" />

- RIP是**应用层协议**（因为是UDP的数据部分）
- 使用**UDP**传送数据
- 一个RIP报文最多可包括25个路由表项的信息
  - 如果超过，必须再用一个RIP报文传送

##### 好消息传得快，坏消息传得慢（慢收敛）

<img src="Network%20Layer.assets/image-20201226205445625.png" alt="image-20201226205445625" style="zoom: 67%;" />

<img src="Network%20Layer.assets/image-20201226205611062.png" alt="image-20201226205611062" style="zoom:67%;" />

<img src="Network%20Layer.assets/image-20201226205704164.png" alt="image-20201226205704164" style="zoom:67%;" />

<img src="Network%20Layer.assets/image-20201226205717838.png" alt="image-20201226205717838" style="zoom:67%;" />

<img src="Network%20Layer.assets/image-20201226205751229.png" alt="image-20201226205751229" style="zoom:67%;" />

#### OSPF协议与链路状态算法

- 适用于比较大的网络
- OSPF：开放（指的是公开发表）最短路径优先（Dijkstra的最短路径算法）
- 使用**分布式的链路状态算法**
- 和谁交换？
  - 洪泛式，向自治系统内的所有路由器发送消息
- 交换什么？
  - 与本路由器相邻的所有路由器的链路状态（**和哪些路由器相邻，以及该链路的度量**）
  - 与RIP协议不同：度量可以是费用、距离、时延、带宽等（**RIP是跳数**）
- 多久交换？
  - 只有当**链路状态发生变化时**，路由器才向所有路由器洪泛发送此信息

##### 链路状态路由算法

- 每隔10s发送一个HELLO问候分组
- 成本度量：metric

![image-20201230194626579](Network%20Layer.assets/image-20201230194626579.png)

##### OSPF的区域

- 给自治系统再分区
- 主干区域的标识符：0.0.0.0
- 主干路由器：主干区域的路由器

![image-20201230194659547](Network%20Layer.assets/image-20201230194659547.png)

##### OSPF分组

- OSPF直接用**IP数据报**传送
- <img src="Network%20Layer.assets/image-20201226211551136.png" alt="image-20201226211551136" style="zoom:50%;" />
- **考纲认为是网络层协议，但可以理解成是传输层协议**

##### OSPF的其他特点

- 每隔30min，要刷新一次数据库中的链路状态
- 由于一个路由器的链路状态只涉及到与相邻路由器的连通状态，因而与整个互联网的**规模**并无直接关系
  - 因此当互联网规模很大时，OSPF协议要好
- OSPF不存在坏消息传得慢的问题，**它的收敛速度很快**



#### BGP协议

- 外部网关协议，自治系统之间使用
- 和谁交换？
  - 与其他AS的邻站的BGP发言人交换信息
  - 至少一个路由器作为AS的BGP发言人
- 交换什么？
  - 网络可达性的信息，即要**到达某个网络所要经过的一系列AS**
- 多久交换？
  - 发生变化时更新有变化的部分

##### BGP协议交换信息的过程

- 选择一个较好的路由即可
- 一个BGP发言人所构造出的自治系统连通图
  - 树形结构，保证不会回到自己
- BGP发言人：有BGP协议和内部路由协议

![image-20201230200612360](Network%20Layer.assets/image-20201230200612360.png)

- 交换的信息是什么？

  - 交换路径的向量

  <img src="Network%20Layer.assets/image-20201230200830158.png" alt="image-20201230200830158" style="zoom: 50%;" />

  <img src="Network%20Layer.assets/image-20201230200846319.png" alt="image-20201230200846319" style="zoom:50%;" />

##### BGP协议报文格式

![image-20201230200956638](Network%20Layer.assets/image-20201230200956638.png)

##### BGP协议特点

- BGP支持CIDR，因此BGP的路由表也就应当包括目的网络前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统
- 发生变化时更新有变化的部分

##### BGP的四种报文









- 路由表
  - 这个结点可能接受包：不分配
  - 路由器远程配置：需要当成目的地，因此有地址
- 永久性虚电路与虚呼叫
  - 虚呼叫是动态的：建立的时候需要路由表
- 虚电路与数据报
  - 考试常考
  - 面向连接的比较费存储器
  - 面向连接的省带宽
  - 省电路更重要：当时认为省带宽更好，因此面向连接更主流
  - 现在：通信电路更便宜
  - 无连接更省事，因此无连接更主流
    - ip是无连接
- 路由算法
  - 决定走哪条路
  - 原则：正确性、简单、健壮（自适应、被破坏）
  - SONET：双环
  - Flooding：洪泛式
    - 往除了来源的方向都各转一个包
    - 缺点：包占用带宽
    - 优点：目的地可能收到很多备份；健壮性（军用、特殊用途）；天生广播
      - 可以作为一切路由选择算法的评价基准
      - 收到的第一个包就是最优的
    - 可以改进的地方
  - Distance Vector Routing：距离矢量算法
    - DV：交换
    - 优点：简单
    - 缺点：好消息反应快，坏消息反应慢，收敛性不好
    - 应用在小的网络里：不担心收敛性
    - ![image-20201124104359088](Network%20Layer.assets/image-20201124104359088.png)
    - 假如A到B断了，结果距离向量越来越大
      - 因为交换的时候不告诉走哪条路
      - 就算交换的时候告诉下一跳，也不能完美（必须告诉沿途所有的），不具体讨论
    - 一般路由器也不会那么多才到：一般限制20个
  - Link State Routing：链路状态
    - 最小生成树
    - 交换的信息量（全网状态）、计算量都比较大
    - 收敛性好，但复杂
  - Hierarchical：层次路由
    - 可路由的和不可路由的（？）（11.24 11：18）
    - 着眼点都是可路由的网络
    - 想办法把计算量做下去
    - 把连接区域的那些结点也跑一个路由算法
  - Multicasting：组播路由
    - 广播复播？
  - Routing for Mobile Hosts：移动主机路由
- 拥塞控制 Congestion Control Algorithms



服务质量

- 概率：服务等级，可区分的服务

比较重要的东西：MPLS

- 无连接：骨干网的路由表项：50万-100万项
- 连接是面向任务的（进程）
- 通信子网之间：有连接
- 边界路由器和主机之间：无连接
- 连接是粗的，很稳定
- 骨干网的主流技术，标记交换
  - 标记交换支持全光交换

Internet

- 路由，中继，网络互联
- 两类：有连接和无连接
  - 面向连接：可靠性好，实时性不好（连接建立久）
- 用什么技术连它们：
  - 有连接、无连接的方式连它们
  - 面向连接的技术连接原本的网络：实时性不好，依据原本的网络是否可靠决定最后的可靠性
  - 无连接的技术连接原本的网络：可靠性不好，依据原本的网络是否实时决定最后的实时性
  - 基本选择无连接的方式连接本来的网络：ip协议

Fragmentation

- 切或者不切
- 透明分段和非透明分段

IP

- Internet protocol
- PDU
- 基本单位为一个字：4个字节
- ip包的头部：整数个字
- ip地址：32bit
  - 源可以随便填，目的必须真实
- 版本：11：00
- offset怎么看：11：23 常考1
  - 砍的时候必须要是8的倍数
- 多少个比特表示网络，多少个比特表示结点
- 主机部分
  - 全0和全1不能用
  - 全1是广播（？）
  - 全0是自己（？）



- NAT: NAPT port
- 配置静态路由
  - 建立静态路由
  - ip route prefix mask {address | interface} [distance] [tag tag] [permanent]
    - prefix：所要到达的目的网络
    - mask：子网掩码
    - address：下一个跳的IP地址，即相邻路由器的端口地址
    - interface：本地网络接口
    - distance：管理距离（可选）
    - tag tag：tag值（可选）
    - permanent：指定此路由即使该端口关掉也不被移掉
  - ip route 192.1.0.64 255.255.255.192 192.200.10.6

<img src="Network%20Layer.assets/image-20201208104120693.png" alt="image-20201208104120693" style="zoom:50%;" />































